<div class="columns pt-2" style="height: 16em" id="charts-container">
  <div class="column">
    <div class="level">
      <div class="level-left">
        <div class="level-item">
          <h2 class="title is-5">Throughput</h2>
        </div>
      </div>
    </div>
    <div id="throughput-chart">
      <%= area_chart({ name: 'req/min', data: @throughput_data }, area_chart_options.merge(colors: ['#43BCCD'], refresh: 30)) %>
    </div>
  </div>
  <div class="column">
    <div class="level">
      <div class="level-left">
        <div class="level-item">
          <h2 class="title is-5">Latency</h2>
        </div>
      </div>
    </div>
    <div id="latency-chart">
      <%= area_chart({ name: 'ms', data: @latency_data }, area_chart_options.merge(colors: ['#13d8aa'], refresh: 30)) %>
    </div>
  </div>
</div>

<script>
// Chart refresh functionality
function refreshCharts() {
  const form = document.getElementById('time-range-form');
  if (form) {
    const formData = new FormData(form);
    const params = new URLSearchParams(formData);
    
    fetch('<%= transactions_path %>?' + params.toString(), {
      headers: {
        'Accept': 'text/html',
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
    .then(response => response.text())
    .then(html => {
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      const newChartsContainer = doc.getElementById('charts-container');
      if (newChartsContainer) {
        document.getElementById('charts-container').innerHTML = newChartsContainer.innerHTML;
      }
    })
    .catch(error => console.error('Error refreshing charts:', error));
  }
}

// Auto-refresh charts based on time range
document.addEventListener('DOMContentLoaded', function() {
  const currentUrl = new URL(window.location.href);
  const hasRecentTimeRange = currentUrl.searchParams.get('quick_range_apply') === '5m' || 
                           currentUrl.searchParams.get('quick_range_apply') === '15m' ||
                           currentUrl.searchParams.get('quick_range_apply') === '30m';
  
  if (hasRecentTimeRange) {
    // Auto-refresh every 30 seconds for recent time ranges
    setInterval(refreshCharts, 30000);
  }
});
</script>
